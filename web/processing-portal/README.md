# Processing Portal (local frontend)

A Blazor Web App that lets you push documents into the `input` blob container and browse/download artifacts from the `output` container created by the background processing pipeline. The app runs locally for now and authenticates using `DefaultAzureCredential`, so it automatically reuses the Azure CLI, VS Code, or managed identity context that is available on the host machine.

## Prerequisites

- .NET SDK 9.0 preview (matching the rest of the repo)
- Azure CLI logged into the subscription that hosts the storage account (`az login`)
- Your user or managed identity must have **Storage Blob Data Contributor** rights on the storage account that backs the pipeline

## Configuration

Set the storage details either in `appsettings.Development.json` or via environment variables. The app needs to know how to reach the blob endpoint but does not require an access key.

The portal automatically hydrates configuration from common azd files—`.env.tmp`, `.env`, `.env.local`, `azure.env`, and any `.azure/<env>/env` **or** `.azure/<env>/.env` generated by `azd env get-values`. Keep one of those files up to date (or run `azd env get-values > .env.tmp`) and the values will be picked up on the next `dotnet run`.

Environment variables:

- `STORAGE_ACCOUNT_NAME` – preferred; builds the blob endpoint as `https://{account}.blob.core.windows.net`
- `STORAGE_BLOB_SERVICE_URI` – optional override if you need a custom endpoint (e.g., Azure Stack)
- `Storage__InputContainer` and `Storage__OutputContainer` – override container names if they differ from the defaults (`input`, `output`)

Example `.env` snippet for local runs:

```bash
export STORAGE_ACCOUNT_NAME="yourstorageaccount"
```

## Run locally

From the repo root:

```bash
dotnet run --project web/processing-portal/ProcessingPortal.csproj
```

The app launches on `https://localhost:5001` (HTTP port 5000). Use the upload panel to push up to five files (200 MB max each). The output grid lists blobs from the `output` container with a direct download link that streams through the server while preserving blob content types.

## How authentication works

`DefaultAzureCredential` tries, in order, environment credentials, managed identity, Visual Studio, Azure CLI, and shared token cache. For local testing, ensure `az login` was executed in the same environment or set the appropriate `AZURE_CLIENT_ID`/`AZURE_TENANT_ID`/`AZURE_CLIENT_SECRET` if you prefer a service principal. No connection strings or keys are required.
